---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# Modana

<!-- badges: start -->
<!-- badges: end -->

The goal `Modana` package is to implement a refinement of moderation analysis with binary outcomes, as proposed by [Anto and Su (2023)](https://journals.sagepub.com/doi/abs/10.1177/09622802231151206?journalCode=smma). The function fits three models of interest: a direct model, an inverse model, and a generalized estimating equation (GEE) model. The direct and inverse models are fitted using the `glm` function to verify the symmetry property of odds ratio/relative risk in moderation analysis for the main treatment effect as well as the moderating effects. The GEE model is fitted using the `geeglm` function and is used to estimate the treatment effect accounting for within-cluster correlation. The `Modana` package has three different built functions.

## Installation

You can install the development version of Modana like so:

``` r
install.packages("Modana_0.1.0.tar.gz", repos = NULL)
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r example}
library(Modana)
## basic example code
```


You can simulate some data to run moderation analysis
```{r data}
set.seed(1099)
b0 <- c(1, 1.2, 1, 1.5, -2, -.5, 1.2, 1.5)
a0 <- c(-1, 1.5, -1, 1.5)
#a0 <- c(-2, 2, 2, 0, 1)
b0 <- c(-1.5, 1.5, 1.5, -2, 2, -.5, -1, 1.5)
 datt <- sim_data(n = 100, b0, a0 = NULL, binary.Xs = FALSE,
                      sigma = 1, uniform = FALSE, c0 = 1,
                      link.function = "logistic", rho = 0.2,
                      observational = FALSE, trt.p = 0.5,
                      interaction = 1:2, details = FALSE)
head(datt)
```



The `refinedmod()` function implements refined moderation analysis to estimate both treatment effect and moderating effects associated with two logistic regression models with binary outcomes/treatment via generalized estimating equations (GEE). 
The function first performs a role swap algorithm on the original data to obtain a clustered data of size `2` (i.e., swapping the roles of the response variable and treatment variable columns in the original data data and then stacking the resultant data on top of the original data).
```{r analysis}
getres <- refinedmod(formula = y ~ trt + x1 + x2 + x3 + x4,
                     detail = TRUE, y = "y",
                    trt = "trt", data = datt,
                     effmod = c("x1", "x2"),
                      corstr = "independence")
names(getres)
```

You can call each elements of listed models

Mostly importantly, we can print the results of the refined estimation.
```{r}
print(getres$Geerefinedmodel)
```


Example usage on a real-world data
```{r}
#install.packages("CERFIT")
library(CERFIT)
data(warts, package =  "CERFIT")
dat <- warts
#data wrangling
dat$Type <- ifelse(dat$Type==3, 1, 0)
dat$response <- dat$Result_of_Treatment
```


```{r}
res <- refinedmod(formula = response ~ treatment + age + Time + Type,
                     detail = FALSE, y = "response",
                    trt = "treatment", data = dat,
                     effmod = c("age", "Type"),
                      corstr = "independence")
print(res$comparisonresults)
```
